---
title: arrange()の練習問題
page-layout: full
title-block-banner: true
comments: false
---

arrangeの練習問題には、

[https://www.e-stat.go.jp/stat-search/file-download?statInfId=000031921674&fileKind=0](https://www.e-stat.go.jp/stat-search/file-download?statInfId=000031921674&fileKind=0)

にある、令和元年度の日本の人口統計データを元に、私が加工したデータを扱います。

取り込むファイルはdata/population.xlsxです。これまで学んだ関数、mutateとかも利用します。

練習問題1

data/population.xlsxに、「男性」と「女性」という二つのシートが含まれています。「女性」シートのデータを取り込んでください。

練習問題2

取り込んだデータの都道府県をアルファベット順で並べ替えてください。

練習問題3

2015年で女性人口が1-5番目の都道府県をみつけてください

練習問題4

2018年で女性人口が40-47番目の都道府県を見つけてください

練習問題5

列名を`2015` -> nen2015の様に、数字ではなくアルファベット+数字の形に書き換えてください。

練習問題6

2017年から2019年にかけて女性人口が増えた都道府県、トップ3を調べてください。



それでは解説していきます


練習問題1

data/population.xlsxに、「男性」と「女性」という二つのシートが含まれています。「女性」シートのデータを取り込んでください。

これは、インポートする話ですね。

```{r}
library(tidyverse)
library(readxl)

dat <- read_excel("data/population.xlsx", sheet="女性")
dat
```

うまく取り込めましたか?

ここで、数字はすべて1000単位なので、100とか書いてあれば100,000で10万人を示しています。

練習問題2

取り込んだデータの都道府県をアルファベット順で並べ替えてください。

取り込んだデータのPrefecture列にローマ字で都道府県名が記載されています。arrange、文字列型に利用するとアルファベット順で並ぶので、

```{r}
dat %>% arrange(Prefecture)
```

で並びました。

練習問題3

2015年で女性人口が1-5番目の都道府県をみつけてください

実は列名が数字単体であるため、`2015`の様にバッククオートで囲んであげるほうがよいです。

```{r}
dat %>% arrange(`2015`)
```

だと、最下位（一番数字が小さい）が上にきてしまうので、

```{r}
dat %>% arrange(desc(`2015`))
```

で並び替えるとOKです。ちなみに、Top5だけをとりだしたいなら、上からXこ取り出してくれる、head()関数を利用してあげると、

```{r}
dat
dat %>% head(1)
dat %>% head(5)
dat %>% arrange(desc(`2015`)) %>% head(5)
```

で上5個を取得できました。

練習問題4

2018年で女性人口が40-47番目の都道府県を見つけてください

```{r}
dat %>% arrange(`2018`)
```

あるいは、tail関数というデータの最後のX行を取得してくれる関数もあるので、

```{r}
dat %>% arrange(desc(`2018`)) %>% tail(8)
dat %>% arrange(`2018`) %>% head(8)
```

などでも調べることができます。

練習問題5

列名を`2015` -> nen2015の様に、数字ではなくアルファベット+数字の形に書き換えてください。

いちいちバッククオートで囲むのも、面倒なので、列名を変えてしまいましょう。

```{r}
dat2 <- dat %>% 
  rename(
    nen2015=`2015`,
    nen2016=`2016`,
    nen2017=`2017`,
    nen2018=`2018`,
    nen2019=`2019`,
  )

dat2
```

練習問題6

2017年から2019年にかけて女性人口が増えた都道府県、トップ3を調べてください。

ここでは、2019年ー2017年としてあげてその差を大きい順にならべる作戦で行きましょう。ついでにいらないnen20xxのデータは消しておきます

```{r}
dat2 %>% 
  select(!c(nen2015,nen2016,nen2018)) %>% 
  mutate(diff = nen2019 - nen2017) %>% 
  arrange(desc(diff))
```

ということで、東京、神奈川、埼玉が女性人口増加トップ3ということでした。東京圧倒的なのと、7位以降が全部マイナスという結果ですね。

いかがでしたでしょうか？

これまでと違い、少し実践的な感じになってきていませんでしょうか？

次は、行を絞り込む、filterの話です。

