---
title: mutate()の実践
page-layout: full
title-block-banner: true
comments: false
---

それでは新しい列を作る関数、mutateを実際に利用していきましょう。

いきなり演習です!

1つ前の動画でスライドでご提示した表を作成して、新しい列を足すこと、できますか?

<pre>
もとの表     できあがった表

|col1|col2|  |col1|col2|new|
|----|----|  |----|----|---|
|1   |10  |  |1   |10  |11 |
|2   |20  |  |2   |20  |22 |
|3   |30  |  |3   |30  |33 |
|4   |40  |  |4   |40  |44 |
|----|----|  |----|----|---|

</pre>

できましたか?

やってみましょう。

```{r}
library(tidyverse)

hyou <- tibble(
  col1=c(1,2,3,4), 
  col2=c(10,20,30,40)
)

hyou

hyou %>% mutate(new = col1 + col2)
```

できましたね?

予測変換にもちゃんと列名がでてきていましたね?

このように列を作るのはmutate関数で簡単にできます。

```{r}
hyou
```

ただし、忘れてはいけないのが、mutate関数は「列を作る」機能しかないので、代入してあげないとこのように折角作成した列が反映されていません。

```{r}
hyou <- hyou %>% mutate(new = col1 + col2)
hyou
```

mutateの動作を色々と確認しておきましょう。

```{r}
hyou %>% 
  mutate(test = 1)
```

このように、長さが1のベクトルを入れると、自動的に複製されて、列ができあがります。

```{r, error=TRUE}
hyou %>% 
  mutate(test = c(1,2))
```

ただし、ベクトルの長さが表の行の長さと一致しない場合は、このようにエラーが生じるので、長さがぴったり　か、　1　である必要があります。

また、mutateは1列だけでなく、同時に複数の列をつくることも可能です。

```{r}
hyou %>% 
  mutate(
    n1 = col1 + col2,
    n2 = col1 - col2,
    n3 = col1 * col2
  )
```

他にも、複数列を作成するときに、同じmutateの中で新たに「先に作成した列」を呼び出すことも可能です

```{r}
hyou %>% 
  mutate(
    n4 = col1 + col2,
    n5 = n4 * col2
  )
```

これは、後に作成したものは呼べないので注意が必要です

```{r, error = TRUE}
hyou %>% 
  mutate(
    n5 = n4 *col2,
    n4 = col1 + col2
  )
```

以上、mutate関数の使い方の説明でした。このmutate関数、多分パイプに次いで多用する関数になるとおもいますので、是非、しっかりと動作を抑えておいてください。次の動画では練習問題とその解答です。

