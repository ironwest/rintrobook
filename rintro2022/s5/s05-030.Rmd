---
title: filter()の練習問題
page-layout: full
title-block-banner: true
comments: false
---

ここでも、arrangeに引き続き、data/population.xlsxを利用しましょう。

練習問題1

data/population.xlsxの「男性」シートからデータを取得してください。
　
練習問題2

列名が数字になっているものの頭にnenを付けてください(例: `2015` -> nen2015)
　
練習問題3

2015年の人口が1000(100万人)以上の都道府県にデータを絞りこんでください
　
練習問題4

2017年から2018年と、2018年から2019年で連続して人口が増加している都道府県に絞り込んでください。

それでは答えを見ていきましょう。

練習問題1

data/population.xlsxの「男性」シートからデータを取得してください。

```{r}
library(tidyverse)
library(readxl)
dat <- read_excel("data/population.xlsx", sheet="男性")
dat
```

ここは特に問題ありませんね？


練習問題2

列名が数字になっているものの頭にnenを付けてください(例: `2015` -> nen2015)

```{r}
colnames(dat)
dat2 <- dat %>% 
  rename(
    nen2015 = `2015`,
    nen2016 = `2016`,
    nen2017 = `2017`,
    nen2018 = `2018`,
    nen2019 = `2019`,
  )
dat2
```

この問題はrename関数の使い方の復習です。

練習問題3

2015年の人口が1000(100万人)以上の都道府県にデータを絞りこんでください

```{r}
dat2 %>% 
  filter(nen2015 >= 1000)
```

fiterの基本的な使い方です。

練習問題4

2017年から2018年と、2018年から2019年で連続して人口が増加している都道府県に絞り込んでください。

この問題は少し難しいかもしれません

答えは、

```{r}
dat2 %>% 
  mutate(diff1718 = nen2018 - nen2017,
         diff1819 = nen2019 - nen2018) %>% 
  filter(diff1718 > 0 & diff1819 > 0) %>% 
  select(`都道府県名`, diff1718, diff1819)
```

となります。

mutateで、まず各年度間の差を計算して、それをfilterで0より大きいものに絞り込んでいます最後のselectは画面に収めるためのものです。

いかがでしたでしょうか?

filter関数とlogicalベクトルの組み合わせで行を絞り込む方法についてイメージはつきましたか？

filter関数、ここまで数字に基づいた絞りこみを行ってきましたが、実は文字列型に対しても絞り込みを行うこともできます。

例えば

```{r}
temp <- tibble(
  name = c("apple","apricot","banana","cherry"),
  price = c(120,200,98,300)
)
temp
```

ですが、appleのみの列に絞りこむなら

```{r}
temp %>% filter(name == "apple")
```

で可能です。

それでは、aで始まるname列のみに絞りこみたいという場合はどうしたらよいでしょうか？

実はそれも簡単にできて、

```{r}
temp %>% filter( str_detect(name,"^a") )
```

また、aで終わる名前に絞りこみたいであれば、

```{r}
temp %>% filter( str_detect(name, "a$"))
```

です。

ここでaで始まるを意味する^aやaで終わるを意味するa$のことを正規表現といいます。

この正規表現を取り扱うためにstr_detectという関数が用意されています。

ここからは、この正規表現について解説して、その後、str_detect等の正規表現を利用できる関数の紹介を行います。

この二つの内容を理解いただけると、

文字列に対して自由にロジカル型のベクトルを設定できるようになり、文字列データを自由に絞り込んだり加工したりすることができるようになりますのでがんばってください。

