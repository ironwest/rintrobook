{
  "hash": "86ef0c72ca992b2f8b7d3d794c6c7a44",
  "result": {
    "markdown": "---\ntitle: 実践 pivot_widerで複数列を横にする\npage-layout: full\ntitle-block-banner: true\ncomments: false\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n:::\n\n\n\n続けて、pivot_widerで複数列に対応する場合を考えてみましょう。\n\n例えば、\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat <- tibble(\n  age = c(\"<20\",\"20-30\",\"30-40\",\">40\",\"<20\",\"20-30\",\"30-40\",\">40\"),\n  grp = c(\"A\",\"B\",\"A\",\"B\",\"A\",\"B\",\"A\",\"B\"),\n  sex = c(\"m\",\"m\",\"m\",\"m\",\"f\",\"f\",\"f\",\"f\"),\n  val = c(1:8)\n)\n\ndat\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 8 × 4\n  age   grp   sex     val\n  <chr> <chr> <chr> <int>\n1 <20   A     m         1\n2 20-30 B     m         2\n3 30-40 A     m         3\n4 >40   B     m         4\n5 <20   A     f         5\n6 20-30 B     f         6\n7 30-40 A     f         7\n8 >40   B     f         8\n```\n:::\n:::\n\n\n\nこのデータ、横持ちにしたときに、列名の部分を<sex_年齢>という形にしたいばあい、実は、pivot_widerのnames_fromに複数変数を与えてあげると自動的に処理をしてくれます。なので、\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat %>% \n  pivot_wider(\n    id_cols = grp, \n    names_from = age,\n    values_from = val\n  )\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Values from `val` are not uniquely identified; output will contain list-cols.\n• Use `values_fn = list` to suppress this warning.\n• Use `values_fn = {summary_fun}` to summarise duplicates.\n• Use the following dplyr code to identify duplicates.\n  {data} %>%\n  dplyr::group_by(grp, age) %>%\n  dplyr::summarise(n = dplyr::n(), .groups = \"drop\") %>%\n  dplyr::filter(n > 1L)\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 5\n  grp   `<20`     `20-30`   `30-40`   `>40`    \n  <chr> <list>    <list>    <list>    <list>   \n1 A     <int [2]> <NULL>    <int [2]> <NULL>   \n2 B     <NULL>    <int [2]> <NULL>    <int [2]>\n```\n:::\n:::\n\n\n\n重複するデータがあるのでListが作られていますが、\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat %>% \n  pivot_wider(\n    id_cols = grp,\n    names_from = c(age, sex),\n    values_from = val\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 9\n  grp   `<20_m` `20-30_m` `30-40_m` `>40_m` `<20_f` `20-30_f` `30-40_f` `>40_f`\n  <chr>   <int>     <int>     <int>   <int>   <int>     <int>     <int>   <int>\n1 A           1        NA         3      NA       5        NA         7      NA\n2 B          NA         2        NA       4      NA         6        NA       8\n```\n:::\n:::\n\n\n\nnames_fromに複数変数を与えてあげると問題が起こりません。\n\n尚、変数名の間は、初期設定では_が挿入されていますが、\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat %>% \n  pivot_wider(\n    id_cols = grp,\n    names_from = c(age, sex),\n    values_from = val,\n    names_sep = \"@@\"\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 9\n  grp   `<20@@m` `20-30@@m` `30-40@@m` `>40@@m` `<20@@f` `20-30@@f` `30-40@@f`\n  <chr>    <int>      <int>      <int>    <int>    <int>      <int>      <int>\n1 A            1         NA          3       NA        5         NA          7\n2 B           NA          2         NA        4       NA          6         NA\n# ℹ 1 more variable: `>40@@f` <int>\n```\n:::\n:::\n\n\n\nで変更可能です。\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat %>% \n  pivot_wider(\n    id_cols = grp,\n    names_from = c(age, sex),\n    values_from = val,\n    names_sep = \"―――\",\n    values_fill = 0\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 9\n  grp   `<20―――m` `20-30―――m` `30-40―――m` `>40―――m` `<20―――f` `20-30―――f`\n  <chr>     <int>       <int>       <int>     <int>     <int>       <int>\n1 A             1           0           3         0         5           0\n2 B             0           2           0         4         0           6\n# ℹ 2 more variables: `30-40―――f` <int>, `>40―――f` <int>\n```\n:::\n:::\n\n\n\n後は、値がNAでなくて、何か別の値で埋めたい場合はvalues_fillに値を与えてあげると自動的に埋めてくれます。\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}