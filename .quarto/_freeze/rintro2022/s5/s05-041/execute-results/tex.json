{
  "hash": "fd44cf3f55101f90f551560ebd389b14",
  "result": {
    "markdown": "---\ntitle: 実践 str_trim\npage-layout: full\ntitle-block-banner: true\ncomments: false\n---\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n:::\n\n\n\nここでは、少しこれまでの話と逆行しますが、正規表現に頼らない方が簡単に処理ができるケースを例示してみます。\n\n正規表現の練習問題2を改めてみてみましょう。次の文字列ベクトルから検査値を抜き出すことが課題でした。\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvec <- c(\"1HbA1c :4.9\", \"2HbA1c: 6.3\", \"3HbA1c : 3\", \"4HbA1c:5\")\nvec\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"1HbA1c :4.9\" \"2HbA1c: 6.3\" \"3HbA1c : 3\"  \"4HbA1c:5\"   \n```\n:::\n:::\n\n\n\nここで、\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprac <- tibble(target = vec)\nprac\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 x 1\n  target     \n  <chr>      \n1 1HbA1c :4.9\n2 2HbA1c: 6.3\n3 3HbA1c : 3 \n4 4HbA1c:5   \n```\n:::\n:::\n\n\n\nこのTibbleを1つ前の動画のように検査名と値に分けてみましょう。正規表現をごりごり利用する場合は、解答にあったように\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprac %>% \n  mutate(\n    value = str_extract(target,\"(?<=:(\\\\s|))(\\\\d+\\\\.\\\\d+|\\\\d+)\"),\n  \n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 x 2\n  target      value\n  <chr>       <chr>\n1 1HbA1c :4.9 4.9  \n2 2HbA1c: 6.3 6.3  \n3 3HbA1c : 3  3    \n4 4HbA1c:5    5    \n```\n:::\n:::\n\n\n\n検査値の抽出だけでも、ぱっとみ分かりにくい正規表現になっています。ただ、ここで、次のようにすると、見通しがかなりよくなりませんか?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprac %>% \n  mutate(\n    left = str_extract(target,\"^.+(?=:)\"),　#コロンの前\n    right = str_extract(target,\"(?<=:).+$\"), #コロンの後\n    name = str_trim(left), #コロンの前の空白除去\n    value = str_trim(right) #コロンの後の空白除去\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 x 5\n  target      left      right  name   value\n  <chr>       <chr>     <chr>  <chr>  <chr>\n1 1HbA1c :4.9 \"1HbA1c \" \"4.9\"  1HbA1c 4.9  \n2 2HbA1c: 6.3 \"2HbA1c\"  \" 6.3\" 2HbA1c 6.3  \n3 3HbA1c : 3  \"3HbA1c \" \" 3\"   3HbA1c 3    \n4 4HbA1c:5    \"4HbA1c\"  \"5\"    4HbA1c 5    \n```\n:::\n:::\n\n\n\nこんな感じでstr_trim関数を利用してあげると、前後のスペースが消えてくれるので、\"(?<=:(\\\\s|))(\\\\d+\\\\.\\\\d+|\\\\d+)\"この正規表現を書かなくても、処理することができました\n\nデータクリーニングするさいには、そのデータを目的の形へ正確に効率よく変換できればOKなので、色々なやり方を試みてください。\n\n後、str_trimの設定について補足しておきます。\n\nstr_trimは\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n?str_trim\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nstarting httpd help server ... done\n```\n:::\n:::\n\n\n\nのUsageでsideというargumentがあります。\n\nこれは、\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntgt <- \"    S     P      A      C      E      !   \"\n\nboth <- str_trim(tgt, side = \"both\")\nleft <- str_trim(tgt, side = \"left\")\nright <- str_trim(tgt, side = \"right\")\n\nstr_view_all(c(tgt, both, left, right), \"\\\\s\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: `str_view()` was deprecated in stringr 1.5.0.\ni Please use `str_view_all()` instead.\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] | < >< >< >< >S< >< >< >< >< >P< >< >< >< >< >< >A< >< >< >< >< >< >C< >< >< >< >< >< >E< >< >< >< >< >< >!< >< >< >\n[2] | S< >< >< >< >< >P< >< >< >< >< >< >A< >< >< >< >< >< >C< >< >< >< >< >< >E< >< >< >< >< >< >!\n[3] | S< >< >< >< >< >P< >< >< >< >< >< >A< >< >< >< >< >< >C< >< >< >< >< >< >E< >< >< >< >< >< >!< >< >< >\n[4] | < >< >< >< >S< >< >< >< >< >P< >< >< >< >< >< >A< >< >< >< >< >< >C< >< >< >< >< >< >E< >< >< >< >< >< >!\n```\n:::\n:::\n\n\n\nこのように、str_view_allで全部当たる結果をみることができるので見てみると、\n\nbothとした場合は両端のスペースleftで左、rightで右のスペースが削除されていることが確認できます。また、スライドでは紹介していませんが、\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n?str_trim\ntgt\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"    S     P      A      C      E      !   \"\n```\n:::\n\n```{.r .cell-code}\nstr_squish(tgt)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"S P A C E !\"\n```\n:::\n:::\n\n\n\n中間の無駄なスペースを除去することができます\n\n以上、str_trimの解説でした。\n\n次の動画で、ここまでのstr_xxx系の関数を利用した練習問題を解いてみましょう!\n\n",
    "supporting": [
      "s05-041_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{},\"value\":[]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}