{
  "hash": "735df5c31c893d0e272274766783566d",
  "result": {
    "markdown": "---\ntitle: arrange()の練習問題\npage-layout: full\ntitle-block-banner: true\ncomments: false\n---\n\n\n\narrangeの練習問題には、\n\n[https://www.e-stat.go.jp/stat-search/file-download?statInfId=000031921674&fileKind=0](https://www.e-stat.go.jp/stat-search/file-download?statInfId=000031921674&fileKind=0)\n\nにある、令和元年度の日本の人口統計データを元に、私が加工したデータを扱います。\n\n取り込むファイルはdata/population.xlsxです。これまで学んだ関数、mutateとかも利用します。\n\n練習問題1\n\ndata/population.xlsxに、「男性」と「女性」という二つのシートが含まれています。「女性」シートのデータを取り込んでください。\n\n練習問題2\n\n取り込んだデータの都道府県をアルファベット順で並べ替えてください。\n\n練習問題3\n\n2015年で女性人口が1-5番目の都道府県をみつけてください\n\n練習問題4\n\n2018年で女性人口が40-47番目の都道府県を見つけてください\n\n練習問題5\n\n列名を`2015` -> nen2015の様に、数字ではなくアルファベット+数字の形に書き換えてください。\n\n練習問題6\n\n2017年から2019年にかけて女性人口が増えた都道府県、トップ3を調べてください。\n\n\n\nそれでは解説していきます\n\n\n練習問題1\n\ndata/population.xlsxに、「男性」と「女性」という二つのシートが含まれています。「女性」シートのデータを取り込んでください。\n\nこれは、インポートする話ですね。\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.2     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.2     ✔ tibble    3.2.1\n✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n✔ purrr     1.0.1     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(readxl)\n\ndat <- read_excel(\"data/population.xlsx\", sheet=\"女性\")\ndat\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 47 × 7\n   都道府県名     Prefecture    `2015` `2016` `2017` `2018` `2019`\n   <chr>          <chr>          <dbl>  <dbl>  <dbl>  <dbl>  <dbl>\n 1 北海道　　　　 Hokkaido        2845   2830   2814   2797   2778\n 2 青森県　　　　 Aomori-ken       694    686    678    670    661\n 3 岩手県　　　　 Iwate-ken        664    658    651    643    635\n 4 宮城県　　　　 Miyagi-ken      1194   1191   1188   1184   1179\n 5 秋田県　　　　 Akita-ken        543    536    528    520    512\n 6 山形県　　　　 Yamagata-ken     584    578    571    565    558\n 7 福島県　　　　 Fukushima-ken    968    960    951    941    931\n 8 茨城県　　　　 Ibaraki-ken     1463   1457   1450   1442   1433\n 9 栃木県　　　　 Tochigi-ken      993    988    983    977    970\n10 群馬県　　　　 Gumma-ken       1000    996    992    987    981\n# ℹ 37 more rows\n```\n:::\n:::\n\n\n\nうまく取り込めましたか?\n\nここで、数字はすべて1000単位なので、100とか書いてあれば100,000で10万人を示しています。\n\n練習問題2\n\n取り込んだデータの都道府県をアルファベット順で並べ替えてください。\n\n取り込んだデータのPrefecture列にローマ字で都道府県名が記載されています。arrange、文字列型に利用するとアルファベット順で並ぶので、\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat %>% arrange(Prefecture)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 47 × 7\n   都道府県名     Prefecture    `2015` `2016` `2017` `2018` `2019`\n   <chr>          <chr>          <dbl>  <dbl>  <dbl>  <dbl>  <dbl>\n 1 愛知県　　　　 Aichi-ken       3742   3752   3761   3767   3773\n 2 秋田県　　　　 Akita-ken        543    536    528    520    512\n 3 青森県　　　　 Aomori-ken       694    686    678    670    661\n 4 千葉県　　　　 Chiba-ken       3127   3136   3143   3150   3155\n 5 愛媛県　　　　 Ehime-ken        731    725    719    713    705\n 6 福井県　　　　 Fukui-ken        405    403    401    398    394\n 7 福岡県　　　　 Fukuoka-ken     2691   2692   2692   2691   2688\n 8 福島県　　　　 Fukushima-ken    968    960    951    941    931\n 9 岐阜県　　　　 Gifu-ken        1048   1043   1035   1029   1022\n10 群馬県　　　　 Gumma-ken       1000    996    992    987    981\n# ℹ 37 more rows\n```\n:::\n:::\n\n\n\nで並びました。\n\n練習問題3\n\n2015年で女性人口が1-5番目の都道府県をみつけてください\n\n実は列名が数字単体であるため、`2015`の様にバッククオートで囲んであげるほうがよいです。\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat %>% arrange(`2015`)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 47 × 7\n   都道府県名     Prefecture    `2015` `2016` `2017` `2018` `2019`\n   <chr>          <chr>          <dbl>  <dbl>  <dbl>  <dbl>  <dbl>\n 1 鳥取県　　　　 Tottori-ken      300    298    295    293    290\n 2 島根県　　　　 Shimane-ken      361    358    355    352    349\n 3 高知県　　　　 Kochi-ken        386    382    377    373    369\n 4 徳島県　　　　 Tokushima-ken    396    393    389    385    381\n 5 福井県　　　　 Fukui-ken        405    403    401    398    394\n 6 山梨県　　　　 Yamanashi-ken    427    424    421    417    414\n 7 佐賀県　　　　 Saga-ken         440    437    434    432    429\n 8 香川県　　　　 Kagawa-ken       504    502    499    496    492\n 9 和歌山県　　　 Wakayama-ken     510    505    501    495    490\n10 秋田県　　　　 Akita-ken        543    536    528    520    512\n# ℹ 37 more rows\n```\n:::\n:::\n\n\n\nだと、最下位（一番数字が小さい）が上にきてしまうので、\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat %>% arrange(desc(`2015`))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 47 × 7\n   都道府県名     Prefecture   `2015` `2016` `2017` `2018` `2019`\n   <chr>          <chr>         <dbl>  <dbl>  <dbl>  <dbl>  <dbl>\n 1 東京都　　　　 Tokyo-to       6849   6907   6964   7020   7075\n 2 大阪府　　　　 Osaka-fu       4583   4583   4583   4581   4582\n 3 神奈川県　　　 Kanagawa-ken   4567   4580   4590   4601   4613\n 4 愛知県　　　　 Aichi-ken      3742   3752   3761   3767   3773\n 5 埼玉県　　　　 Saitama-ken    3638   3651   3662   3672   3682\n 6 千葉県　　　　 Chiba-ken      3127   3136   3143   3150   3155\n 7 兵庫県　　　　 Hyogo-ken      2893   2887   2879   2870   2861\n 8 北海道　　　　 Hokkaido       2845   2830   2814   2797   2778\n 9 福岡県　　　　 Fukuoka-ken    2691   2692   2692   2691   2688\n10 静岡県　　　　 Shizuoka-ken   1879   1872   1866   1856   1847\n# ℹ 37 more rows\n```\n:::\n:::\n\n\n\nで並び替えるとOKです。ちなみに、Top5だけをとりだしたいなら、上からXこ取り出してくれる、head()関数を利用してあげると、\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 47 × 7\n   都道府県名     Prefecture    `2015` `2016` `2017` `2018` `2019`\n   <chr>          <chr>          <dbl>  <dbl>  <dbl>  <dbl>  <dbl>\n 1 北海道　　　　 Hokkaido        2845   2830   2814   2797   2778\n 2 青森県　　　　 Aomori-ken       694    686    678    670    661\n 3 岩手県　　　　 Iwate-ken        664    658    651    643    635\n 4 宮城県　　　　 Miyagi-ken      1194   1191   1188   1184   1179\n 5 秋田県　　　　 Akita-ken        543    536    528    520    512\n 6 山形県　　　　 Yamagata-ken     584    578    571    565    558\n 7 福島県　　　　 Fukushima-ken    968    960    951    941    931\n 8 茨城県　　　　 Ibaraki-ken     1463   1457   1450   1442   1433\n 9 栃木県　　　　 Tochigi-ken      993    988    983    977    970\n10 群馬県　　　　 Gumma-ken       1000    996    992    987    981\n# ℹ 37 more rows\n```\n:::\n\n```{.r .cell-code}\ndat %>% head(1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 7\n  都道府県名     Prefecture `2015` `2016` `2017` `2018` `2019`\n  <chr>          <chr>       <dbl>  <dbl>  <dbl>  <dbl>  <dbl>\n1 北海道　　　　 Hokkaido     2845   2830   2814   2797   2778\n```\n:::\n\n```{.r .cell-code}\ndat %>% head(5)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5 × 7\n  都道府県名     Prefecture `2015` `2016` `2017` `2018` `2019`\n  <chr>          <chr>       <dbl>  <dbl>  <dbl>  <dbl>  <dbl>\n1 北海道　　　　 Hokkaido     2845   2830   2814   2797   2778\n2 青森県　　　　 Aomori-ken    694    686    678    670    661\n3 岩手県　　　　 Iwate-ken     664    658    651    643    635\n4 宮城県　　　　 Miyagi-ken   1194   1191   1188   1184   1179\n5 秋田県　　　　 Akita-ken     543    536    528    520    512\n```\n:::\n\n```{.r .cell-code}\ndat %>% arrange(desc(`2015`)) %>% head(5)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5 × 7\n  都道府県名     Prefecture   `2015` `2016` `2017` `2018` `2019`\n  <chr>          <chr>         <dbl>  <dbl>  <dbl>  <dbl>  <dbl>\n1 東京都　　　　 Tokyo-to       6849   6907   6964   7020   7075\n2 大阪府　　　　 Osaka-fu       4583   4583   4583   4581   4582\n3 神奈川県　　　 Kanagawa-ken   4567   4580   4590   4601   4613\n4 愛知県　　　　 Aichi-ken      3742   3752   3761   3767   3773\n5 埼玉県　　　　 Saitama-ken    3638   3651   3662   3672   3682\n```\n:::\n:::\n\n\n\nで上5個を取得できました。\n\n練習問題4\n\n2018年で女性人口が40-47番目の都道府県を見つけてください\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat %>% arrange(`2018`)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 47 × 7\n   都道府県名     Prefecture    `2015` `2016` `2017` `2018` `2019`\n   <chr>          <chr>          <dbl>  <dbl>  <dbl>  <dbl>  <dbl>\n 1 鳥取県　　　　 Tottori-ken      300    298    295    293    290\n 2 島根県　　　　 Shimane-ken      361    358    355    352    349\n 3 高知県　　　　 Kochi-ken        386    382    377    373    369\n 4 徳島県　　　　 Tokushima-ken    396    393    389    385    381\n 5 福井県　　　　 Fukui-ken        405    403    401    398    394\n 6 山梨県　　　　 Yamanashi-ken    427    424    421    417    414\n 7 佐賀県　　　　 Saga-ken         440    437    434    432    429\n 8 和歌山県　　　 Wakayama-ken     510    505    501    495    490\n 9 香川県　　　　 Kagawa-ken       504    502    499    496    492\n10 秋田県　　　　 Akita-ken        543    536    528    520    512\n# ℹ 37 more rows\n```\n:::\n:::\n\n\n\nあるいは、tail関数というデータの最後のX行を取得してくれる関数もあるので、\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat %>% arrange(desc(`2018`)) %>% tail(8)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 8 × 7\n  都道府県名     Prefecture    `2015` `2016` `2017` `2018` `2019`\n  <chr>          <chr>          <dbl>  <dbl>  <dbl>  <dbl>  <dbl>\n1 和歌山県　　　 Wakayama-ken     510    505    501    495    490\n2 佐賀県　　　　 Saga-ken         440    437    434    432    429\n3 山梨県　　　　 Yamanashi-ken    427    424    421    417    414\n4 福井県　　　　 Fukui-ken        405    403    401    398    394\n5 徳島県　　　　 Tokushima-ken    396    393    389    385    381\n6 高知県　　　　 Kochi-ken        386    382    377    373    369\n7 島根県　　　　 Shimane-ken      361    358    355    352    349\n8 鳥取県　　　　 Tottori-ken      300    298    295    293    290\n```\n:::\n\n```{.r .cell-code}\ndat %>% arrange(`2018`) %>% head(8)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 8 × 7\n  都道府県名     Prefecture    `2015` `2016` `2017` `2018` `2019`\n  <chr>          <chr>          <dbl>  <dbl>  <dbl>  <dbl>  <dbl>\n1 鳥取県　　　　 Tottori-ken      300    298    295    293    290\n2 島根県　　　　 Shimane-ken      361    358    355    352    349\n3 高知県　　　　 Kochi-ken        386    382    377    373    369\n4 徳島県　　　　 Tokushima-ken    396    393    389    385    381\n5 福井県　　　　 Fukui-ken        405    403    401    398    394\n6 山梨県　　　　 Yamanashi-ken    427    424    421    417    414\n7 佐賀県　　　　 Saga-ken         440    437    434    432    429\n8 和歌山県　　　 Wakayama-ken     510    505    501    495    490\n```\n:::\n:::\n\n\n\nなどでも調べることができます。\n\n練習問題5\n\n列名を`2015` -> nen2015の様に、数字ではなくアルファベット+数字の形に書き換えてください。\n\nいちいちバッククオートで囲むのも、面倒なので、列名を変えてしまいましょう。\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat2 <- dat %>% \n  rename(\n    nen2015=`2015`,\n    nen2016=`2016`,\n    nen2017=`2017`,\n    nen2018=`2018`,\n    nen2019=`2019`,\n  )\n\ndat2\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 47 × 7\n   都道府県名     Prefecture    nen2015 nen2016 nen2017 nen2018 nen2019\n   <chr>          <chr>           <dbl>   <dbl>   <dbl>   <dbl>   <dbl>\n 1 北海道　　　　 Hokkaido         2845    2830    2814    2797    2778\n 2 青森県　　　　 Aomori-ken        694     686     678     670     661\n 3 岩手県　　　　 Iwate-ken         664     658     651     643     635\n 4 宮城県　　　　 Miyagi-ken       1194    1191    1188    1184    1179\n 5 秋田県　　　　 Akita-ken         543     536     528     520     512\n 6 山形県　　　　 Yamagata-ken      584     578     571     565     558\n 7 福島県　　　　 Fukushima-ken     968     960     951     941     931\n 8 茨城県　　　　 Ibaraki-ken      1463    1457    1450    1442    1433\n 9 栃木県　　　　 Tochigi-ken       993     988     983     977     970\n10 群馬県　　　　 Gumma-ken        1000     996     992     987     981\n# ℹ 37 more rows\n```\n:::\n:::\n\n\n\n練習問題6\n\n2017年から2019年にかけて女性人口が増えた都道府県、トップ3を調べてください。\n\nここでは、2019年ー2017年としてあげてその差を大きい順にならべる作戦で行きましょう。ついでにいらないnen20xxのデータは消しておきます\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat2 %>% \n  select(!c(nen2015,nen2016,nen2018)) %>% \n  mutate(diff = nen2019 - nen2017) %>% \n  arrange(desc(diff))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 47 × 5\n   都道府県名     Prefecture   nen2017 nen2019  diff\n   <chr>          <chr>          <dbl>   <dbl> <dbl>\n 1 東京都　　　　 Tokyo-to        6964    7075   111\n 2 神奈川県　　　 Kanagawa-ken    4590    4613    23\n 3 埼玉県　　　　 Saitama-ken     3662    3682    20\n 4 千葉県　　　　 Chiba-ken       3143    3155    12\n 5 愛知県　　　　 Aichi-ken       3761    3773    12\n 6 沖縄県　　　　 Okinawa-ken      734     738     4\n 7 滋賀県　　　　 Shiga-ken        716     715    -1\n 8 大阪府　　　　 Osaka-fu        4583    4582    -1\n 9 福岡県　　　　 Fukuoka-ken     2692    2688    -4\n10 鳥取県　　　　 Tottori-ken      295     290    -5\n# ℹ 37 more rows\n```\n:::\n:::\n\n\n\nということで、東京、神奈川、埼玉が女性人口増加トップ3ということでした。東京圧倒的なのと、7位以降が全部マイナスという結果ですね。\n\nいかがでしたでしょうか？\n\nこれまでと違い、少し実践的な感じになってきていませんでしょうか？\n\n次は、行を絞り込む、filterの話です。\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}