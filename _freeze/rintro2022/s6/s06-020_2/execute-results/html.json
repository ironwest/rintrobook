{
  "hash": "c589c888ea5b9bb89fede997d067456d",
  "result": {
    "markdown": "---\ntitle: 差の計算の課題と解答\npage-layout: full\ntitle-block-banner: true\ncomments: false\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n{\n  set.seed(123456)\n  dat <-  tibble(\n    id = 1:30,\n    tx = sample(c(\"E\",\"F\"),30,replace=TRUE),\n    base = runif(30,12,40)\n  ) %>% \n    mutate(val = map2(base,tx,~{\n      init <- .\n      diff <- if(.y==\"E\"){-2}else{1}\n      end <- init + rnorm(1,diff,3)\n      \n      seq(init,end,length.out=10) +\n        c(0,rnorm(8,0,1),0)\n    }))\n  \n  dat <- dat %>% unnest(c(val)) %>% \n    select(id,tx,val)\n  \n  write_excel_csv(dat,\"data/laglead.csv\")\n}#データ生成の関数\n```\n:::\n\n\n\nそれでは、出題します。\n\n1) data/laglead.csvというデータを読み込んでください。\n\n2) 読み込んだデータは、idが個々人を表す数値で、valには、10回測定したBMIの数値が含まれています。この、測定から測定間の差を計算してください\n\n3) 各々のid毎に、最終測定結果　-　初回測定結果の値をもとめてください。\n\n4) Txという変数は、その人たちに運動(Exercise)か食事(Food)のどちらにとりくんだかの変数です。EとF、おのおのについて初回と最後の測定の体重の変化量を\n\n利用して\n\n* p_weight: 体重が減少した人数の割合\n* mean_weight: 体重の変化の平均値\n\nという変数でもとめてみてください。\n\n\nそれでは、動画をとめて、とりくんでみてください。\n\nやってみましたか?\n\n答え合わせをしてみましょう。\n\n1) data/laglead.csvというデータを読み込んでください。\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\ndat <- read_csv(\"data/laglead.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 300 Columns: 3\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (1): tx\ndbl (2): id, val\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n:::\n\n\n2)読み込んだデータは、idが\n個々人を表す数値で、valには、\n10回測定したBMIの数値が含まれています。\nこの、測定から測定間の差を計算してください\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat %>% \n  group_by(id) %>% \n  mutate(prev_val = lag(val)) %>% \n  mutate(diff_val = val - prev_val)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 300 × 5\n# Groups:   id [30]\n      id tx      val prev_val diff_val\n   <dbl> <chr> <dbl>    <dbl>    <dbl>\n 1     1 F      26.6     NA    NA     \n 2     1 F      26.5     26.6  -0.105 \n 3     1 F      25.2     26.5  -1.29  \n 4     1 F      23.4     25.2  -1.88  \n 5     1 F      24.8     23.4   1.44  \n 6     1 F      24.9     24.8   0.0940\n 7     1 F      27.2     24.9   2.25  \n 8     1 F      26.4     27.2  -0.719 \n 9     1 F      26.3     26.4  -0.145 \n10     1 F      25.1     26.3  -1.22  \n# ℹ 290 more rows\n```\n:::\n:::\n\n\n\nこれで、diff_valには前回から今回にかけて変化した量が保存されます。\n\n2) 各々のid毎に、最終測定結果　-　初回測定結果の値をもとめてください。\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat %>% \n  group_by(id) %>% \n  summarise(init = first(val),\n            last = last(val)) %>% \n  mutate(l_f = last - init)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 30 × 4\n      id  init  last     l_f\n   <dbl> <dbl> <dbl>   <dbl>\n 1     1  26.6 25.1  -1.57  \n 2     2  36.3 34.0  -2.35  \n 3     3  18.5 22.7   4.26  \n 4     4  15.3  8.86 -6.47  \n 5     5  35.1 35.5   0.446 \n 6     6  14.2 15.1   0.858 \n 7     7  38.7 33.5  -5.19  \n 8     8  36.4 36.4  -0.0339\n 9     9  31.9 29.3  -2.62  \n10    10  29.0 30.7   1.75  \n# ℹ 20 more rows\n```\n:::\n:::\n\n\n3) Txという変数は、その人たちに運動(Exercise)か食事(Food)のどちらにとりくんだかの変数です。EとF、おのおのについて初回と最後の測定の体重の変化量を\n\n利用して\n\n* p_weight: 体重が減少した人数の割合\n* mean_weight: 体重の変化の平均値\n\nという変数でもとめてみてください。\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat %>% \n  group_by(tx,id) %>% \n  summarise(diff = last(val)- first(val)) %>% \n  summarise(\n    p_weight = sum(diff < 0)/n(),\n    mean_weight = mean(diff)\n  )\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'tx'. You can override using the `.groups`\nargument.\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 3\n  tx    p_weight mean_weight\n  <chr>    <dbl>       <dbl>\n1 E        0.769     -2.29  \n2 F        0.529      0.0607\n```\n:::\n:::\n\n\n\nということで、txがEの方がBMIが減っている人の割合も大きいし、数値の変化も平均的に2.29減っているということがわかりました。(このデータは、架空のものです）\n\nいかがでしょうか?\n\n集計を利用してこのように、データの変数を加工すること、なんとなくイメージがついたでしょうか?\n\n次の動画では、ここで紹介した方法と組み合わせることが多い、時間のデータを取り扱う方法について簡単に説明してセクションを締めくくろうと思います。\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}